<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>C/Wasm QR Code Generator</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        background-color: #333;
        color: #eee;
      }
      pre {
        display: inline-block;
        background-color: white;
        color: black;
        padding: 20px;
        line-height: 1;
        font-size: 10px;
        border: 4px solid #fff;
      }
      input {
        font-size: 1.2em;
        padding: 10px;
        width: 60%;
      }
      button {
        font-size: 1.2em;
        padding: 10px 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>C/Wasm QR Code Generator</h1>
    <input
      type="text"
      id="url-input"
      value="https://en.wikipedia.org/wiki/WebAssembly"
    />
    <br /><br />
    <button id="generate-button" disabled>Generate QR Code</button>
    <div id="qr-container" style="margin-top: 20px"></div>

    <script>
      const urlInput = document.getElementById("url-input");
      const generateButton = document.getElementById("generate-button");
      const qrContainer = document.getElementById("qr-container");

      var Module = {
        onRuntimeInitialized: function () {
          console.log("Wasm module loaded.");
          generateButton.disabled = false; // Enable the button

          // Wrap the C function for easy calling
          const createQrString = Module.cwrap(
            "create_qr_string", // Name of C function
            "string", // Return type
            ["string"] // Argument types
          );

          generateButton.addEventListener("click", () => {
            const url = urlInput.value;
            if (!url) {
              alert("Please enter a URL or text.");
              return;
            }

            // Call the C function!
            const qrString = createQrString(url);

            // Display the result in a <pre> tag for correct formatting
            qrContainer.innerHTML = `<pre>${qrString}</pre>`;
          });
        },
      };
    </script>
    <script async src="qr_generator.js"></script>
  </body>
</html>
